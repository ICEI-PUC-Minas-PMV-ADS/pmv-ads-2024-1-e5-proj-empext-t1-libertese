@model Libertese.Domain.Entities.Financeiro.ClienteDTO

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Libertese</title>
    <link rel="stylesheet" href="~/../sidebar/assets/css/styles.css" asp-append-version="true" />
    <link href="../scaffold/css/vendors/flatpickr.min.css" rel="stylesheet">
    <link href="../scaffold/style.css" rel="stylesheet">
    <style>
        svg:hover {
            cursor: pointer;
        }
    </style>
</head>

<body>
    <form asp-controller="Clientes" asp-action="Create" method="post" class="w-full sm:flex flex-col">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
        <div class="grid gap-5 md:grid-cols-2">
            <div>
                <div>
                    <div class="flex items-center justify-between">
                        <label asp-for="Nome" class="block text-sm font-medium mb-1" for="tooltip"></label>
                        <div class="relative ml-2"
                             x-data="{ open: false }"
                             @@mouseenter="open = true"
                             @@mouseleave="open = false">
                            <button class="block"
                                    aria-haspopup="true"
                                    :aria-expanded="open"
                                    @@focus="open = true"
                                    @@focusout="open = false"
                                    @@click.prevent>
                                <svg class="w-4 h-4 fill-current text-slate-400 dark:text-slate-500" viewBox="0 0 16 16">
                                    <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm0 12c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm1-3H7V4h2v5z" />
                                </svg>
                            </button>
                            <div class="z-10 absolute bottom-full left-1/2 -translate-x-1/2">
                                <div class="min-w-60 bg-slate-800 text-slate-200 px-2 py-1 rounded overflow-hidden mb-2"
                                     x-show="open"
                                     x-transition:enter="transition ease-out duration-200 transform"
                                     x-transition:enter-start="opacity-0 translate-y-2"
                                     x-transition:enter-end="opacity-100 translate-y-0"
                                     x-transition:leave="transition ease-out duration-200"
                                     x-transition:leave-start="opacity-100"
                                     x-transition:leave-end="opacity-0"
                                     x-cloak>
                                    <div class="text-sm">Informe o nome do cliente ou nome da empresa</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <input asp-for="Nome" class="form-input w-full input-nome" type="text" />
                    <span asp-validation-for="Nome" class="text-xs mt-1 text-rose-500"></span>
                </div>
            </div>
        
        <div>
            <div>
                <div class="flex items-center justify-between">
                    <label id="cpfCnpjLabel" asp-for="CpfCnpj" class="block text-sm font-medium mb-1" for="cpfInput">Digite o CPF:</label>
                    <div class="relative ml-2"
                         x-data="{ open: false }"
                         @@mouseenter="open = true"
                         @@mouseleave="open = false">
                        <button class="block"
                                aria-haspopup="true"
                                :aria-expanded="open"
                                @@focus="open = true"
                                @@focusout="open = false"
                                @@click.prevent>
                            <svg class="w-4 h-4 fill-current text-slate-400 dark:text-slate-500" viewBox="0 0 16 16">
                                <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm0 12c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm1-3H7V4h2v5z" />
                            </svg>
                        </button>
                        <div class="z-10 absolute bottom-full left-1/2 -translate-x-1/2">
                            <div class="min-w-60 bg-slate-800 text-slate-200 px-2 py-1 rounded overflow-hidden mb-2"
                                 x-show="open"
                                 x-transition:enter="transition ease-out duration-200 transform"
                                 x-transition:enter-start="opacity-0 translate-y-2"
                                 x-transition:enter-end="opacity-100 translate-y-0"
                                 x-transition:leave="transition ease-out duration-200"
                                 x-transition:leave-start="opacity-100"
                                 x-transition:leave-end="opacity-0"
                                 x-cloak>
                                <div class="text-sm">Informe o CPF ou CNPJ do cliente.</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-cpf">
                    <input asp-for="CpfCnpj" id="cpfInput" class="form-input w-full input-cpf" />
                    <span asp-validation-for="CpfCnpj" class="text-xs mt-1 text-rose-500"></span>
                </div>
            </div>
        </div>
        <div>
            <div>
                <div class="flex items-center justify-between">
                    <label asp-for="Telefone" class="block text-sm font-medium mb-1" for="tooltip">Telefone:</label>
                    <div class="relative ml-2"
                         x-data="{ open: false }"
                         @@mouseenter="open = true"
                         @@mouseleave="open = false">
                        <button class="block"
                                aria-haspopup="true"
                                :aria-expanded="open"
                                @@focus="open = true"
                                @@focusout="open = false"
                                @@click.prevent>
                            <svg class="w-4 h-4 fill-current text-slate-400 dark:text-slate-500" viewBox="0 0 16 16">
                                <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm0 12c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm1-3H7V4h2v5z" />
                            </svg>
                        </button>
                        <div class="z-10 absolute bottom-full left-1/2 -translate-x-1/2">
                            <div class="min-w-60 bg-slate-800 text-slate-200 px-2 py-1 rounded overflow-hidden mb-2"
                                 x-show="open"
                                 x-transition:enter="transition ease-out duration-200 transform"
                                 x-transition:enter-start="opacity-0 translate-y-2"
                                 x-transition:enter-end="opacity-100 translate-y-0"
                                 x-transition:leave="transition ease-out duration-200"
                                 x-transition:leave-start="opacity-100"
                                 x-transition:leave-end="opacity-0"
                                 x-cloak>
                                <div class="text-sm">Digite o telefone</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-telefone">
                    <input asp-for="Telefone" class="form-input w-full input-telefone" />
                    <span asp-validation-for="Telefone" class="text-xs mt-1 text-rose-500"></span>
                </div>
            </div>
        </div>
        <div>
            <div>
                <div class="flex items-center justify-between">
                    <label asp-for="Email" class="block text-sm font-medium mb-1" for="tooltip">E-mail:</label>
                    <div class="relative ml-2"
                         x-data="{ open: false }"
                         @@mouseenter="open = true"
                         @@mouseleave="open = false">
                        <button class="block"
                                aria-haspopup="true"
                                :aria-expanded="open"
                                @@focus="open = true"
                                @@focusout="open = false"
                                @@click.prevent>
                            <svg class="w-4 h-4 fill-current text-slate-400 dark:text-slate-500" viewBox="0 0 16 16">
                                <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm0 12c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm1-3H7V4h2v5z" />
                            </svg>
                        </button>
                        <div class="z-10 absolute bottom-full left-1/2 -translate-x-1/2">
                            <div class="min-w-60 bg-slate-800 text-slate-200 px-2 py-1 rounded overflow-hidden mb-2"
                                 x-show="open"
                                 x-transition:enter="transition ease-out duration-200 transform"
                                 x-transition:enter-start="opacity-0 translate-y-2"
                                 x-transition:enter-end="opacity-100 translate-y-0"
                                 x-transition:leave="transition ease-out duration-200"
                                 x-transition:leave-start="opacity-100"
                                 x-transition:leave-end="opacity-0"
                                 x-cloak>
                                <div class="text-sm">Digite o e-mail</div>
                            </div>
                        </div>
                    </div>
                </div>
                <input asp-for="Email" id="email" class="form-input w-full input-email" />
                <span asp-validation-for="Email" class="text-xs mt-1 text-rose-500"></span>
            </div>              
        </div>
            <footer>
                <div class="flex flex-col items-center px-6 py-5 border-t border-slate-200 dark:border-slate-700">
                    <div class="flex justify-center">
                        <button id="submitForm" name="submitForm" type="submit" value="Salvar" class="btn bg-slate-900 hover:bg-orange-600 text-white rounded-lg w-32">
                            Confirmar
                        </button>
                    </div>
                </div>
            </footer>
    </form>

</body>
</html>

<script>
    function formatarCPF(cpf) {
        // Remove qualquer caracter que não seja número
        cpf = cpf.replace(/\D/g, '');
        // Adiciona a formatação
        cpf = cpf.replace(/(\d{3})(\d)/, '$1.$2');
        cpf = cpf.replace(/(\d{3})(\d)/, '$1.$2');
        cpf = cpf.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
        return cpf;
    }

    function formatarCNPJ(cnpj) {
        // Remove qualquer caracter que não seja número
        cnpj = cnpj.replace(/\D/g, '');
        // Adiciona a formatação
        cnpj = cnpj.replace(/(\d{2})(\d)/, '$1.$2');
        cnpj = cnpj.replace(/(\d{3})(\d)/, '$1.$2');
        cnpj = cnpj.replace(/(\d{3})(\d)/, '$1/$2');
        cnpj = cnpj.replace(/(\d{4})(\d{1,2})$/, '$1-$2');
        return cnpj;
    }

    document.getElementById('cpfInput').addEventListener('input', function (event) {
        var input = event.target;
        var value = input.value;

        // Remove caracteres que não sejam números
        value = value.replace(/\D/g, '');

        if (value.length > 14) {
            // Impede que mais de 14 dígitos sejam inseridos para o CNPJ
            value = value.slice(0, 14);
        }

        if (value.length > 11) {
            // Alterar o rótulo e o placeholder para CNPJ
            document.getElementById('cpfCnpjLabel').textContent = 'Digite o CNPJ:';
            input.placeholder = 'CNPJ';
            input.value = formatarCNPJ(value);
        } else {
            // Alterar o rótulo e o placeholder para CPF
            document.getElementById('cpfCnpjLabel').textContent = 'Digite o CPF:';
            input.placeholder = 'CPF';
            input.value = formatarCPF(value);
        }
    });

    document.querySelector('form').addEventListener('submit', function (event) {
        var cpfInput = document.getElementById('cpfInput');
        var value = cpfInput.value;

        // Remove caracteres que não sejam números
        value = value.replace(/\D/g, '');

        if (value.length > 14) {
            // Impede que mais de 14 dígitos sejam inseridos para o CNPJ
            value = value.slice(0, 14);
        }

        if (value.length <= 11) {
            // Validação para CPF
            if (!validarCPF(value)) {
                alert('Por favor, insira um CPF válido no formato XXX.XXX.XXX-XX.');
                event.preventDefault();
            }
        } else {
            // Validação para CNPJ
            if (!validarCNPJ(value)) {
                alert('Por favor, insira um CNPJ válido no formato XX.XXX.XXX/XXXX-XX.');
                event.preventDefault();
            }
        }
    });

    // Função para formatar o número de telefone
    function formatarTelefone(telefone) {
        // Remove todos os caracteres que não são dígitos
        var cleaned = telefone.replace(/\D/g, '');
        // Aplica a formatação (XX) XXXXX-XXXX
        var match = cleaned.match(/^(\d{0,2})(\d{0,5})(\d{0,4})$/);
        if (match) {
            // Concatena os grupos capturados com os separadores
            return (!match[2] ? match[1] : '(' + match[1] + ') ' + match[2]) + (match[3] ? '-' + match[3] : '');
        }
        return telefone;
    }

    // Adiciona o evento de formatação ao campo de telefone
    document.getElementById('Telefone').addEventListener('input', function (event) {
        var telefoneInput = event.target;
        var formatted = formatarTelefone(telefoneInput.value);
        // Atualiza o valor do campo com o número de telefone formatado
        telefoneInput.value = formatted;
    });

    // Intercepta o envio do formulário para validar o número de telefone
    document.querySelector('form').addEventListener('submit', function (event) {
        var botaoSubmit = document.activeElement;
        // Verifica se o botão clicado é o botão de criar (Confirmar)
        if (botaoSubmit && botaoSubmit.id === 'botao-create') {
            var telefoneInput = document.getElementById('Telefone');
            var telefone = telefoneInput.value.replace(/\D/g, ''); // Remove todos os caracteres que não são dígitos
            // Verifica se o número de telefone possui 11 dígitos após a formatação
            if (telefone.length !== 11) {
                // Impede o envio do formulário
                event.preventDefault();
                // Exibe uma mensagem de erro
                alert('Por favor, insira um número de telefone válido no formato (XX) XXXXX-XXXX');
            }
        }
    });

    function validarCPF(cpf) {
        // Remove caracteres não numéricos
        cpf = cpf.replace(/\D/g, '');
        // Verifica se o CPF tem exatamente 11 dígitos
        return cpf.length === 11;
    }

    function validarCNPJ(cnpj) {
        // Remove caracteres não numéricos
        cnpj = cnpj.replace(/\D/g, '');
        // Verifica se o CNPJ tem exatamente 14 dígitos
        return cnpj.length === 14;
    }

    function hoverEffect(svg, isHovering) {
        if (isHovering) {
            svg.style.opacity = '0.5';
        } else {
            svg.style.opacity = '1';
        }
    }

    function pulseEffect(svg) {
        svg.style.opacity = '0.8';
        setTimeout(() => {
            svg.style.opacity = '1';
        }, 500);
    }
</script>
